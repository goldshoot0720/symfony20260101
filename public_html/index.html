<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>鋒兄AI資訊系統</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 250px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-right: 1px solid rgba(255, 255, 255, 0.2);
        }

        .logo {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            font-size: 18px;
            font-weight: bold;
        }

        .logo i {
            background: #ff4757;
            padding: 8px;
            border-radius: 8px;
            margin-right: 10px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: white;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(255, 255, 255, 0.2);
        }

        .nav-item i {
            margin-right: 12px;
            width: 20px;
        }

        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .page-title {
            font-size: 28px;
            font-weight: bold;
        }

        .page-subtitle {
            color: rgba(255, 255, 255, 0.8);
            margin-top: 5px;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 20px;
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 18px;
        }

        .card-title {
            font-size: 18px;
            font-weight: bold;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .tech-stack {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .tech-section h4 {
            margin-bottom: 10px;
            color: #ffd700;
        }

        .tech-section ul {
            list-style: none;
        }

        .tech-section li {
            padding: 5px 0;
            opacity: 0.9;
        }

        .tech-section li:before {
            content: " ";
            color: #ff4757;
            margin-right: 8px;
        }

        .hidden {
            display: none;
        }

        .btn {
            background: #ff4757;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #ff3742;
            transform: translateY(-2px);
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online {
            background: #27ae60;
        }

        .status-offline {
            background: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="logo">
                <i class="fas fa-robot"></i>
                鋒兄AI系統
            </div>
            
            <nav>
                <a href="#" class="nav-item active" data-page="home">
                    <i class="fas fa-home"></i>
                    首頁
                </a>
                <a href="#" class="nav-item" data-page="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    儀表板
                </a>
                <a href="#" class="nav-item" data-page="foods">
                    <i class="fas fa-utensils"></i>
                    食品管理
                </a>
                <a href="#" class="nav-item" data-page="subscriptions">
                    <i class="fas fa-calendar-check"></i>
                    訂閱管理
                </a>
                <a href="/test.html" class="nav-item">
                    <i class="fas fa-flask"></i>
                    系統測試
                </a>
            </nav>
        </div>

        <div class="main-content">
            <!-- 首頁 -->
            <div id="home-page" class="page">
                <div class="header">
                    <div>
                        <div class="page-title">
                            <i class="fas fa-robot" style="color: #ff4757; margin-right: 10px;"></i>
                            鋒兄AI資訊系統
                        </div>
                        <div class="page-subtitle">智能管理您的食品存貨和訂閱服務，支援到期提醒和快速搜尋</div>
                    </div>
                    <div>
                        <span class="status-indicator status-online" id="system-status"></span>
                        <span id="status-text">系統運行中</span>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #ffd700; color: #333;">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="card-title">系統功能選單</div>
                    </div>
                    
                    <div class="dashboard-grid">
                        <div class="card" style="cursor: pointer;" onclick="showPage('foods')">
                            <div class="card-header">
                                <div class="card-icon" style="background: #e74c3c;">
                                    <i class="fas fa-utensils"></i>
                                </div>
                                <div class="card-title">食品管理</div>
                            </div>
                            <p>管理您的食品存貨和到期提醒</p>
                        </div>

                        <div class="card" style="cursor: pointer;" onclick="showPage('subscriptions')">
                            <div class="card-header">
                                <div class="card-icon" style="background: #3498db;">
                                    <i class="fas fa-calendar-check"></i>
                                </div>
                                <div class="card-title">訂閱管理</div>
                            </div>
                            <p>管理您的各種訂閱服務和會員資訊</p>
                        </div>

                        <div class="card" style="cursor: pointer;" onclick="showPage('dashboard')">
                            <div class="card-header">
                                <div class="card-icon" style="background: #27ae60;">
                                    <i class="fas fa-tachometer-alt"></i>
                                </div>
                                <div class="card-title">系統儀表板</div>
                            </div>
                            <p>查看系統統計和即時狀態</p>
                        </div>

                        <div class="card" style="cursor: pointer;" onclick="window.open('/test.html', '_blank')">
                            <div class="card-header">
                                <div class="card-icon" style="background: #9b59b6;">
                                    <i class="fas fa-flask"></i>
                                </div>
                                <div class="card-title">系統測試</div>
                            </div>
                            <p>測試系統功能和API狀態</p>
                        </div>
                    </div>

                    <div class="tech-stack">
                        <div class="tech-section">
                            <h4><i class="fas fa-cogs"></i> 前端技術</h4>
                            <ul>
                                <li>響應式設計</li>
                                <li>現代化 JavaScript</li>
                                <li>Font Awesome 圖標</li>
                            </ul>
                        </div>
                        <div class="tech-section">
                            <h4><i class="fas fa-server"></i> 後端技術</h4>
                            <ul>
                                <li>PHP + MySQL</li>
                                <li>RESTful API</li>
                                <li>僅兩個資料表 (food, subscription)</li>
                            </ul>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 30px;">
                        <a href="/test.html" class="btn">
                            <i class="fas fa-flask"></i> 系統測試
                        </a>
                        <a href="/api/status" class="btn">
                            <i class="fas fa-heartbeat"></i> API 狀態
                        </a>
                        <a href="/config/database.php" class="btn">
                            <i class="fas fa-database"></i> 數據庫檢查
                        </a>
                    </div>

                    <div style="text-align: center; margin-top: 30px; padding: 20px; background: rgba(255, 255, 255, 0.1); border-radius: 8px;">
                        <p style="font-size: 14px; opacity: 0.8;">鋒兄達智公開資訊  版權所有 2025 - 2125</p>
                    </div>
                </div>
            </div>

            <!-- 其他頁面 -->
            <div id="dashboard-page" class="page hidden">
                <div class="header">
                    <div>
                        <div class="page-title">系統儀表板</div>
                        <div class="page-subtitle">即時監控和管理各項資訊</div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #3498db;">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <div class="card-title">系統統計</div>
                    </div>
                    <div id="dashboard-stats">載入中...</div>
                </div>
            </div>

            <div id="foods-page" class="page hidden">
                <div class="header">
                    <div>
                        <div class="page-title">食品管理系統</div>
                        <div class="page-subtitle">管理您的食品存貨和到期資訊</div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #e74c3c;">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <div class="card-title">食品列表</div>
                    </div>
                    <div id="foods-list">載入中...</div>
                </div>
            </div>

            <div id="subscriptions-page" class="page hidden">
                <div class="header">
                    <div>
                        <div class="page-title">訂閱管理系統</div>
                        <div class="page-subtitle">管理您的各種訂閱服務和會員資訊</div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon" style="background: #3498db;">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="card-title">訂閱列表</div>
                    </div>
                    <div id="subscriptions-list">載入中...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 頁面切換功能
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.add('hidden');
            });
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const targetPage = document.getElementById(pageId + '-page');
            if (targetPage) {
                targetPage.classList.remove('hidden');
            }
            
            const targetNav = document.querySelector(`[data-page="${pageId}"]`);
            if (targetNav) {
                targetNav.classList.add('active');
            }

            // 載入對應頁面的數據
            loadPageData(pageId);
        }

        // 載入頁面數據
        async function loadPageData(pageId) {
            if (pageId === 'dashboard') {
                loadDashboardData();
            } else if (pageId === 'foods') {
                loadFoodsData();
            } else if (pageId === 'subscriptions') {
                loadSubscriptionsData();
            }
        }

        // 載入儀表板數據
        async function loadDashboardData() {
            const container = document.getElementById('dashboard-stats');
            container.innerHTML = '載入中...';
            
            try {
                const response = await fetch('/api/dashboard');
                const data = await response.json();
                
                if (data.status === 'success') {
                    container.innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #e74c3c;">${data.data.foods.total}</div>
                                <div>食品總數</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #f39c12;">${data.data.foods.expiring_7_days}</div>
                                <div>7天內到期</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #3498db;">${data.data.subscriptions.total}</div>
                                <div>訂閱總數</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 24px; font-weight: bold; color: #f39c12;">${data.data.subscriptions.expiring_7_days}</div>
                                <div>7天內到期</div>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                container.innerHTML = '載入失敗';
            }
        }

        // 載入食品數據
        async function loadFoodsData() {
            const container = document.getElementById('foods-list');
            container.innerHTML = '載入中...';
            
            try {
                const response = await fetch('/api/foods');
                const data = await response.json();
                
                if (data.status === 'success') {
                    const html = data.data.map(food => `
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong>${food.name}</strong><br>
                                    <small>數量: ${food.quantity || food.amount} | 到期: ${food.expiry_date || food.todate}</small>
                                </div>
                                <div style="color: ${getStatusColor(food.status)};">
                                    ${food.status}
                                </div>
                            </div>
                        </div>
                    `).join('');
                    container.innerHTML = html || '暫無數據';
                }
            } catch (error) {
                container.innerHTML = '載入失敗';
            }
        }

        // 載入訂閱數據
        async function loadSubscriptionsData() {
            const container = document.getElementById('subscriptions-list');
            container.innerHTML = '載入中...';
            
            try {
                const response = await fetch('/api/subscriptions');
                const data = await response.json();
                
                if (data.status === 'success') {
                    const html = data.data.map(sub => `
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong>${sub.name}</strong><br>
                                    <small>價格: $${sub.price} | 下次付款: ${sub.next_payment_date || sub.nextdate}</small>
                                </div>
                                <div style="color: ${getStatusColor(sub.status)};">
                                    ${sub.status}
                                </div>
                            </div>
                        </div>
                    `).join('');
                    container.innerHTML = html || '暫無數據';
                }
            } catch (error) {
                container.innerHTML = '載入失敗';
            }
        }

        // 獲取狀態顏色
        function getStatusColor(status) {
            if (status === '新鮮' || status === '正常') return '#27ae60';
            if (status === '即將到期') return '#f39c12';
            if (status === '已過期') return '#e74c3c';
            return '#ffffff';
        }

        // 導航點擊事件
        document.querySelectorAll('.nav-item[data-page]').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const pageId = item.getAttribute('data-page');
                if (pageId) {
                    showPage(pageId);
                }
            });
        });

        // 系統狀態檢查
        function checkSystemStatus() {
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        document.getElementById('system-status').className = 'status-indicator status-online';
                        document.getElementById('status-text').textContent = '系統運行中';
                    }
                })
                .catch(error => {
                    document.getElementById('system-status').className = 'status-indicator status-offline';
                    document.getElementById('status-text').textContent = '系統離線';
                });
        }

        // 初始化
        showPage('home');
        checkSystemStatus();
        
        // 每30秒檢查一次系統狀態
        setInterval(checkSystemStatus, 30000);

        console.log('🚀 鋒兄AI資訊系統已載入');
    </script>
</body>
</html>
